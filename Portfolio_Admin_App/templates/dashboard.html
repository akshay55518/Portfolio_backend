{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<div class="container my-5">

  <!-- Dashboard Header -->
  <div class="text-center mb-5">
    <h1 class="fw-bold">📊 Portfolio Dashboard</h1>
    <p class="text-muted">Manage your projects, portfolio, experience, skills, and contact messages.</p>
  </div>

  <div class="d-flex justify-content-center text-center mb-5">
    <div class="col-md-2 mb-3">
      <div class="p-3 bg-light rounded shadow-sm">
        <h2 class="fw-bold">{{ stats.total_projects }}</h2>
        <p class="mb-0 text-muted">Projects</p>
      </div>
    </div>
    <div class="col-md-2 mb-3">
      <div class="p-3 bg-light rounded shadow-sm">
        <h2 class="fw-bold">{{ stats.total_portfolios }}</h2>
        <p class="mb-0 text-muted">Portfolio Entries</p>
      </div>
    </div>
    <div class="col-md-2 mb-3">
      <div class="p-3 bg-light rounded shadow-sm">
        <h2 class="fw-bold">{{ stats.total_experiences }}</h2>
        <p class="mb-0 text-muted">Experiences</p>
      </div>
    </div>
    <div class="col-md-2 mb-3">
      <div class="p-3 bg-light rounded shadow-sm">
        <h2 class="fw-bold">{{ stats.total_skills }}</h2>
        <p class="mb-0 text-muted">Skills</p>
      </div>
    </div>
    <div class="col-md-2 mb-3">
      <div class="p-3 bg-light rounded shadow-sm">
        <h2 class="fw-bold">{{ stats.total_messages }}</h2>
        <p class="mb-0 text-muted">Contact Messages</p>
      </div>
    </div>
  </div>

    <!-- About Section -->
    <div class="card shadow-lg mb-5 border-0">
      <div class="card-header bg-gradient rounded-top text-black fs-5 fw-bold">About Section</div>
      <div class="card-body p-4">
        <form method="post">
          {% csrf_token %}
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Name</label>
              <input type="text" name="name" class="form-control" value="{{ about.name }}">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Email</label>
              <input type="email" name="email" class="form-control" value="{{ about.email }}">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Mobile</label>
              <input type="text" name="mobile" class="form-control" value="{{ about.mobile }}">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Location</label>
              <input type="text" name="location" class="form-control" value="{{ about.location }}">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Role</label>
              <input type="text" name="role" class="form-control" value="{{ about.role }}">
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label fw-semibold">Description 1</label>
            <textarea name="description1" class="form-control" rows="3">{{ about.description1 }}</textarea>
          </div>

          <div class="mt-3">
            <label class="form-label fw-semibold">Description 2</label>
            <textarea name="description2" class="form-control" rows="3">{{ about.description2 }}</textarea>
          </div>

          <div class="row mt-3 g-3">
            <div class="col-md-4">
              <label class="form-label fw-semibold">Instagram</label>
              <input type="url" name="instagram" class="form-control" value="{{ about.instagram }}">
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">Github</label>
              <input type="url" name="github" class="form-control" value="{{ about.github }}">
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">LinkedIn</label>
              <input type="url" name="linkedin" class="form-control" value="{{ about.linkedin }}">
            </div>
          </div>

          <div class="d-flex justify-content-end mt-4">
            <button type="submit" class="btn btn-success btn-lg px-5">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Projects Section -->
    <div class="card shadow-lg mb-5 border-0">
      <div class="card-header bg-primary text-white fw-bold fs-5"><a class="nav-link text-white"
          href="{% url 'projects' %}">Projects</a></div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Title</th>
                <th>Problem</th>
                <th>Approach</th>
                <th>Tech Stack</th>
                <th>Results</th>
                <th>Link</th>
                <th>Created</th>
              </tr>
            </thead>
            <tbody>
              {% for project in projects %}
              <tr>
                <td><strong>{{ project.title }}</strong></td>
                <td>{{ project.problem|truncatewords:12 }}</td>
                <td>{{ project.approach|truncatewords:12 }}</td>
                <td>{{ project.techStack }}</td>
                <td>{{ project.results|truncatewords:12 }}</td>
                <td>
                  {% if project.link %}
                  <a href="{{ project.link }}" target="_blank" class="btn btn-sm btn-outline-primary">View</a>
                  {% else %}-{% endif %}
                </td>
                <td>{{ project.created_at|date:"d M Y" }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="7" class="text-center text-muted">No projects yet.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Portfolio Section -->
    <div class="card shadow-lg mb-5 border-0">
      <div class="card-header bg-success text-white fw-bold fs-5"><a class="nav-link text-white"
          href="{% url 'portfolio' %}">Portfolio</a></div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Title</th>
                <th>Category</th>
                <th>Description</th>
                <th>Link</th>
                <th>Created</th>
              </tr>
            </thead>
            <tbody>
              {% for port in portfolios %}
              <tr>
                <td><strong>{{ port.title }}</strong></td>
                <td>{{ port.category }}</td>
                <td>{{ port.description|truncatewords:18 }}</td>
                <td>
                  {% if port.link %}
                  <a href="{{ port.link }}" target="_blank" class="btn btn-sm btn-outline-success">View</a>
                  {% else %}-{% endif %}
                </td>
                <td>{{ port.created_at|date:"d M Y" }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center text-muted">No portfolio entries.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Experience Section -->
    <div class="card shadow-lg mb-5 border-0">
      <div class="card-header bg-warning text-dark fw-bold fs-5"><a class="nav-link text-white"
          href="{% url 'experience' %}">Experiences</a></div>
      <div class="card-body p-4">
        {% for exp in experiences %}
        <div class="mb-4 border-bottom pb-3">
          <h5 class="fw-bold">{{ exp.role }} <small class="text-muted">at {{ exp.company }}</small></h5>
          <p class="mb-1"><strong>Time:</strong> {{ exp.time }}</p>
          <ul class="mb-0">
            {% for task in exp.work_done %}
            <li>{{ task }}</li>
            {% endfor %}
          </ul>
        </div>
        {% empty %}
        <p class="text-muted">No experience records.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Skills Section -->
    <div class="card shadow-lg mb-5 border-0">
  <div class="card-header bg-info text-white fw-bold fs-5">
    <a class="nav-link text-white" href="{% url 'skills' %}">Skills</a>
  </div>
  <div class="card-body p-4">
    {% for category in skill_categories %}
      <h6 class="fw-bold mt-3">{{ category.name }}</h6>
      <canvas id="skillsChart{{ forloop.counter }}" height="100"></canvas>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const ctx = document.getElementById("skillsChart{{ forloop.counter }}").getContext("2d");
          new Chart(ctx, {
            type: "bar",  // you can change to "radar" or "doughnut"
            data: {
              labels: [{% for skill in category.skills.all %}"{{ skill.name }}",{% endfor %}],
              datasets: [{
                label: "Skill Level (%)",
                data: [{% for skill in category.skills.all %}{{ skill.level }},{% endfor %}],
                backgroundColor: "rgba(23, 162, 184, 0.6)", // Bootstrap info color
                borderColor: "rgba(23, 162, 184, 1)",
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: false },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  max: 100,
                  ticks: { stepSize: 20 }
                }
              }
            }
          });
        });
      </script>
    {% empty %}
      <p class="text-muted">No skills added.</p>
    {% endfor %}
  </div>
</div>

<!-- Load Chart.js CDN once -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <!-- Contact Messages Section -->
    <div class="card shadow-lg mb-5 border-0">
  <div class="card-header bg-danger text-white fw-bold fs-5 d-flex justify-content-between align-items-center">
    <a class="nav-link text-white" href="{% url 'contact' %}">📩 Contact Messages</a>
    <span class="badge bg-light text-danger">{{ contact_messages|length }}</span>
  </div>

  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover table-striped align-middle mb-0">
        <thead class="table-danger">
          <tr>
            <th>👤 Name</th>
            <th>📧 Email</th>
            <th>💬 Message</th>
            <th>⏰ Received</th>
          </tr>
        </thead>
        <tbody>
          {% for msg in contact_messages %}
          <tr>
            <td class="fw-semibold">{{ msg.name }}</td>
            <td>
              <a href="mailto:{{ msg.email }}" class="text-decoration-none text-dark">
                {{ msg.email }}
              </a>
            </td>
            <td>
              <span data-bs-toggle="tooltip" data-bs-placement="top" title="{{ msg.message }}">
                {{ msg.message|truncatewords:12 }}
              </span>
            </td>
            <td>
              <span class="badge bg-danger-subtle text-danger border">
                {{ msg.created_at|date:"d M Y, H:i" }}
              </span>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4" class="text-center text-muted py-4">No messages received yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Enable tooltips -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
  });
</script>


  </div>

  {% endblock content %}